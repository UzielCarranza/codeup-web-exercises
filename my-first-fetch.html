<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>Title</title>
    <style>

        body {
            background-color: rgb(220, 220, 240);
        }

        .country--selection {
            margin: 0;
        }

        #cost-living {
            margin-bottom: 2em;
        }

        #section {
            margin-bottom: 4em;
        }

        #container {
            display: flex;
            flex-direction: column;
            justify-content: space-evenly;
        }

        .sho--info {
            width: 50%;
            margin: auto;
        }
        #weather{
            display: flex;
            flex-direction: column;
            justify-content: space-evenly;
        }
    </style>


</head>
<body>


<!--from weather exercise-->
<h1>5 Day weather</h1>
<!--<div id="icon"><img class="wicon" src="" alt="Weather icon"></div>-->
<div id="weather"></div>
<div>
    <p>
        Your location is <span id="latitude">0.00</span>°
        latitude by <span id="longitude">0.00</span>° longitude.
    </p>
    <button id="get-location">
        Get My Location
    </button>
</div>


<section id="container">
    <div id="cost-living"></div>
    <section id="section"></section>

    <!--    look for cities-->
    <div class="sho--info">

        <h1>What country is your city from</h1>
        <label for="search">Look for cities: </label>
        <input id="search" type="text" placeholder="type here...">
        <div class="country--selection">
            <ul class="addMe"></ul>
        </div>
    </div>

</section>
<section id="show-country--cities">

</section>
<script src="js/keys.js"></script>

<script src="https://code.jquery.com/jquery-2.2.4.min.js"
        integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
<script>

    //do fetch stuff


    //get it right away, no click
    fetch("https://api.openweathermap.org/data/2.5/onecall?lat=" + 41.03 +  "&lon=" + -87.23 + "&units=" + "Imperial" + "&appid=" + OWM_KEY)
        // after response
        .then(response => response.json())

        .then(data => {
            console.log(data.daily[0].weather[0].icon)
            let html = "";
            let counter = 0;
            var iconcode;
            console.log(iconurl)
            html += '<ul>'
            for (let i = 0; i < 5; i++) {
                // let days = ['monday', 'tuesday', 'wednesday', 'thrusday', 'friday', 'saturday', 'sunday']
               let  days = data.daily[i];
                // console.log(days, "days")
                counter++
                iconcode = data.daily[i].weather[0].icon
                console.log(iconcode)
                let dailyTemp = data.daily[i].temp.day;

                var iconurl =  "http://openweathermap.org/img/wn/"+iconcode +"@2x.png";

                $('.wicon').attr('src', iconurl);
                html += '<li>' + counter + ' day will be like: ' + dailyTemp + ' this is icon CODE: ' + iconcode  +
                    '<img href="#" class=wicon src="http://openweathermap.org/img/wn/'+iconcode+'@2x.png ">' + '</img>'  + '</li> ';
            }
            html += '</ul>'
            $('#weather').html(html)

        });

    let units = "Imperial"
    //get location
    let button = document.getElementById("get-location");
    let latText = document.getElementById("latitude");
    let longText = document.getElementById("longitude");

    button.addEventListener("click", function () {
        navigator.geolocation.getCurrentPosition(function (position) {
            let lat = position.coords.latitude;
            let long = position.coords.longitude;

            latText.innerText = lat.toFixed(2);
            longText.innerText = long.toFixed(2);
            userLon = parseFloat(longText.innerText)
            userLat = parseFloat(latText.innerText)
            console.log(userLon, "user long")
            console.log(userLat, "user lat")



            fetch("https://api.openweathermap.org/data/2.5/onecall?lat=" + userLat + "&lon=" + userLon + "&units=" + units + "&appid=" + OWM_KEY)
                // after response
                .then(response => response.json())

                .then(data => {
                    console.log(data)
                    let html = "";
                    let counter = 0;
                    var iconcode;
                    console.log(iconurl)
                    html += '<ul>'
                    for (let i = 0; i < 5; i++) {
                        // let days = ['monday', 'tuesday', 'wednesday', 'thrusday', 'friday', 'saturday', 'sunday']
                        let  days = data.daily[i];
                        // console.log(days, "days")
                        counter++
                        iconcode = data.daily[i].weather[0].icon
                        console.log(iconcode)
                        let dailyTemp = data.daily[i].temp.day;

                        var iconurl =  "http://openweathermap.org/img/wn/"+iconcode +"@2x.png";

                        $('.wicon').attr('src', iconurl);
                        html += '<li>' + counter + ' day will be like: ' + dailyTemp + ' this is icon CODE: ' + iconcode  +
                            '<img href="#" class=wicon src="http://openweathermap.org/img/wn/'+iconcode+'@2x.png ">' + '</img>'  + '</li> ';
                    }
                    html += '</ul>'
                    $('#weather').html(html)


                });
        });
    });


    //ends get location


    // https://api.openweathermap.org/data/2.5/onecall?lat=33.44&lon=-94.04&exclude=hourly,daily&appid={API key}

    fetch("https://cost-of-living-and-prices.p.rapidapi.com/cities", {
        "method": "GET",
        "headers": {
            "x-rapidapi-host": "cost-of-living-and-prices.p.rapidapi.com",
            "x-rapidapi-key": COL_P_KEY
        }
    })
        .then(response => response.json()
        )
        .then(data => {
            // console.log(data.cities[0])

            let html = "";
            html += '<h1>'
            let cities = data.cities[0].city_name;
            html += cities;
            html += '</h1>'
            $('#cost-living').html(html)
/// 1st section portion
            let location = ""
            let ulHtml = "";
            ulHtml += '<ul>'
            let countryName = data.cities[0].country_name
            let countryLng = data.cities[0].lng
            let countryLat = data.cities[0].lat
            ulHtml = '<li>' + "country: " + countryName + '</li>' +
                '<li>' + "location: " + countryLng + countryLat + '</li>'
            ulHtml += '</ul>'
            $('#section').html(ulHtml)

            //search cities
            $('#search').keyup(function (e) {

                e.preventDefault()
                let userInput = $('#search').val();

                //
                let sectionDiv = '';
                let sectionDivCities;
                let sectionsDivsCountryes;
                for (let i = 0; i < 8000; i++) {
                    sectionDivCities = data.cities[i].city_name;
                    sectionsDivsCountryes = data.cities[i].country_name
                    let newCitiesArray = [];
                    if (sectionDivCities.toLowerCase().startsWith(userInput)) {
                        newCitiesArray.push(sectionDivCities)
                        for (let i in newCitiesArray) {
                            var appendThis = "<li>" + 'the city : ' + '<strong>' + newCitiesArray[i] + '</strong>' + ' is located in  the country of: ' + sectionsDivsCountryes + "</li>"
                            $('.addMe').html(appendThis)
                        }

                    }
                }
            }) //search cities ends


        })


</script>
</body>
</html>